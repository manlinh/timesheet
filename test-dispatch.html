<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Webhook 測試</title>
</head>
<body>
  <h2>🔧 GitHub Actions 測試工具</h2>
  <p>請輸入你的 <code>Personal Access Token</code>（classic + repo 權限）</p>

  <input id="token" placeholder="ghp_..." style="width:90%;padding:8px;">
  <button onclick="testDispatch()">🚀 測試觸發 Actions</button>

  <pre id="output" style="white-space:pre-wrap;margin-top:1em;background:#eee;padding:1em;"></pre>

  <script>
    async function testDispatch() {
      const token = document.getElementById("token").value.trim();
      const out = document.getElementById("output");
      if (!token) return alert("請輸入 token");

      const payload = {
        event_type: "update-calendar",
        client_payload: {
          calendar: JSON.stringify({ sample: "測試資料" }),
          log: JSON.stringify([{ event: "測試異動", time: Date.now() }])
        }
      };

      const res = await fetch("https://api.github.com/repos/manlinh/timesheet/dispatches", {
        method: "POST",
        headers: {
          "Accept": "application/vnd.github.v3+json",
          "Authorization": "token " + token,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      const text = await res.text();
      out.textContent =
        `📡 回應狀態：${res.status}\n------\n${text}`;
      console.log("✅ Debug Response:", res.status, await res.text());
    }
  </script>
</body>
</html>
