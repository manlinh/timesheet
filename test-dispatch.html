<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Webhook æ¸¬è©¦</title>
</head>
<body>
  <h2>ğŸ”§ GitHub Actions æ¸¬è©¦å·¥å…·</h2>
  <p>è«‹è¼¸å…¥ä½ çš„ <code>Personal Access Token</code>ï¼ˆclassic + repo æ¬Šé™ï¼‰</p>

  <input id="token" placeholder="ghp_..." style="width:90%;padding:8px;">
  <button onclick="testDispatch()">ğŸš€ æ¸¬è©¦è§¸ç™¼ Actions</button>

  <pre id="output" style="white-space:pre-wrap;margin-top:1em;background:#eee;padding:1em;"></pre>

  <script>
    async function testDispatch() {
      const token = document.getElementById("token").value.trim();
      const out = document.getElementById("output");
      if (!token) return alert("è«‹è¼¸å…¥ token");

      const payload = {
        event_type: "update-calendar",
        client_payload: {
          calendar: JSON.stringify({ sample: "æ¸¬è©¦è³‡æ–™" }),
          log: JSON.stringify([{ event: "æ¸¬è©¦ç•°å‹•", time: Date.now() }])
        }
      };

      const res = await fetch("https://api.github.com/repos/manlinh/timesheet/dispatches", {
        method: "POST",
        headers: {
          "Accept": "application/vnd.github.v3+json",
          "Authorization": "token " + token,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      const text = await res.text();
      out.textContent =
        `ğŸ“¡ å›æ‡‰ç‹€æ…‹ï¼š${res.status}\n------\n${text}`;
      console.log("âœ… Debug Response:", res.status, await res.text());
    }
  </script>
</body>
</html>
